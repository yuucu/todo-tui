# Todo TUI - 機能仕様書

## 1. 基本機能

### 1.1 タスク管理機能

#### タスク表示
- **完了タスク**: チェックマーク付きで表示、薄いグレー色
- **未完了タスク**: 通常表示
- **優先度表示**: (A), (B), (C), (D)でカラー分け
- **日付表示**: 作成日、完了日、期限日を識別可能

#### タスク操作
| 操作 | キー | 説明 |
|------|------|------|
| 新規追加 | `a` | 新しいタスクを追加 |
| 編集 | `e` | 選択したタスクを編集 |
| 完了切り替え | `Enter` | タスクを完了/未完了に切り替え |
| 削除 | `d` | 確認ダイアログ後にタスクを削除 |
| 復元 | `r` | 削除・完了したタスクを復元 |
| 優先度変更 | `p` | 優先度を循環変更 (A→B→C→D→なし) |

### 1.2 フィルタリング機能

#### 利用可能なフィルタ

1. **すべて**: 全タスクを表示
2. **未完了**: 完了していないタスクのみ
3. **完了済み**: 完了したタスクのみ
4. **優先度付き**: 優先度が設定されたタスク
5. **プロジェクトなし**: プロジェクトタグ（+project）が設定されていないタスク
6. **プロジェクト別**: `+project`形式で分類
7. **コンテキスト別**: `@context`形式で分類
8. **期限別**:
   - 今日期限
   - 明日期限
   - 今週期限
   - 期限切れ

#### フィルタ操作
- **選択**: フィルタペインで`Enter`キーで適用
- **カウント表示**: 各フィルタに該当するタスク数を表示
- **動的更新**: タスクの変更に合わせてカウントが自動更新

### 1.3 ナビゲーション機能

#### ペイン切り替え
| キー | 動作 |
|------|------|
| `Tab` | フィルタペイン⇔タスクペイン |
| `h` | フィルタペインに移動 |
| `l` | タスクペインに移動 |

#### リスト内ナビゲーション
| キー | 動作 |
|------|------|
| `j` | 下に移動 |
| `k` | 上に移動 |
| `Home` | 最上位に移動 |
| `End` | 最下位に移動 |

## 2. 高度な機能

### 2.1 日本語入力サポート

#### IME対応
- **完全なIME統合**: 日本語、中国語、韓国語等の入力メソッド対応
- **環境変数設定**: `LANG`および`LC_CTYPE`の自動設定
- **文字エンコーディング**: UTF-8での正確な文字処理

#### 入力モード
- **追加モード**: 新規タスク入力時にIME有効
- **編集モード**: 既存タスク編集時にIME有効
- **検索モード**: 将来実装予定のインクリメンタルサーチでIME対応

### 2.2 ファイル監視・同期

#### 自動ファイル監視
- **リアルタイム更新**: 外部でのファイル変更を即座に検知
- **競合回避**: ファイル書き込み競合の防止機能
- **エラーハンドリング**: ファイルアクセスエラーの適切な処理

#### ファイル操作
```go
// 実装例
type FileWatcher struct {
    watcher *fsnotify.Watcher
    todoFile string
    callback func()
}
```

### 2.3 設定システム

#### 設定ファイル形式
- **対応形式**: YAML, JSON, TOML, HCL
- **設定場所**: `~/.config/todotui/config.yaml`
- **コマンドライン**: `--config`オプションで指定可能

#### 設定可能項目
```yaml
theme: catppuccin           # テーマ選択
priority_levels:            # 優先度レベル
  - ""
  - A
  - B  
  - C
  - D
default_todo_file: ~/todo.txt  # デフォルトファイル
ui:
  left_pane_ratio: 0.33        # 左ペイン幅比率
  min_left_pane_width: 18      # 最小左ペイン幅
  min_right_pane_width: 28     # 最小右ペイン幅
  vertical_padding: 2          # 垂直パディング
```

## 3. todo.txt形式仕様

### 3.1 サポートするtodo.txt要素

#### 基本要素
```
(A) Call Mom @phone +family due:2025-01-15
x 2025-01-14 Clean garage @home +chores
Buy milk @store +groceries
```

- **優先度**: `(A)`, `(B)`, `(C)`, `(D)`
- **完了マーク**: `x` + 完了日
- **作成日**: ISO 8601形式 (YYYY-MM-DD)
- **プロジェクト**: `+project`形式
- **コンテキスト**: `@context`形式
- **カスタムキー**: `key:value`形式

#### 日付形式
- **標準形式**: `YYYY-MM-DD`
- **対応するキー**:
  - `due:` - 期限日
  - `created:` - 作成日（明示的）
  - `completed:` - 完了日（明示的）

### 3.2 拡張機能

#### 独自キー対応
- `priority:` - 数値による優先度
- `estimate:` - 作業時間見積もり
- `tags:` - カンマ区切りタグ

## 4. エラーハンドリング

### 4.1 ファイル関連エラー

#### 対応するエラー
- **ファイル不存在**: 自動作成
- **権限エラー**: エラーメッセージ表示
- **ディスク容量不足**: 適切な警告
- **ファイル破損**: バックアップからの復元提案

#### エラー表示
```go
type ErrorType int

const (
    ErrorFileNotFound ErrorType = iota
    ErrorPermission
    ErrorDiskSpace
    ErrorFormat
)
```

### 4.2 入力検証

#### タスク入力検証
- **空文字チェック**: 空のタスクは作成不可
- **文字数制限**: 実用的な範囲での制限
- **特殊文字**: todo.txt形式に準拠した文字のみ許可

#### 日付検証
- **形式チェック**: ISO 8601形式の強制
- **有効性検証**: 存在しない日付の拒否
- **論理チェック**: 完了日 ≥ 作成日 の検証

## 5. パフォーマンス仕様

### 5.1 応答性能
- **キー入力応答**: 50ms以内
- **ファイル読み込み**: 10,000タスクまで1秒以内
- **フィルタリング**: リアルタイム更新（遅延なし）

### 5.2 メモリ使用量
- **ベースライン**: 10MB以下
- **大量タスク**: 100,000タスクでも50MB以内
- **メモリリーク**: 長時間実行でもメモリ増加なし

### 5.3 ファイルサイズ制限
- **推奨上限**: 10MB（約50,000タスク）
- **動作保証**: 100MB（約500,000タスク）まで
- **警告表示**: 50MB超過時に性能警告 